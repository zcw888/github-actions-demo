name: GitHub Actions Build and Deploy Demo
on:
  push:
    branches:
      - aliyun-deploy-test
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      # If you're using actions/checkout@v2 you must set persist-credentials to false in most cases for the deployment to work correctly.
      uses: actions/checkout@v2
      with:
        persist-credentials: false
    - name: Npm Install and Build
      run: |
        npm install
        npm run-script build
#    - name: Deploy
#      uses: JamesIves/github-pages-deploy-action@releases/v3
#      with:
#        ACCESS_TOKEN: ${{ secrets.ACTION_ACCESS_TOKEN }}
#        BRANCH: gh-pages
#        FOLDER: build
      # Deploy Aliyun
    - name: Deploy Aliyun
      uses: easingthemes/ssh-deploy@v2.0.7
      env:
        SSH_PRIVATE_KEY: ${{ secrets.ALIYUN_IFP3_DEV2_SERVER_SSH_KEY }}
        ARGS: "-aP -e 'ssh -p 9528' -r"
#        ARGS: "-avz --delete"
        SOURCE: "dist/"
        REMOTE_HOST: ${{ secrets.ALIYUN_IFP3_DEV2_REMOTE_HOST }}
        REMOTE_USER: ${{ secrets.ALIYUN_IFP3_DEV2_REMOTE_USER }}
        REMOTE_PORT: ${{ secrets.ALIYUN_IFP3_DEV2_REMOTE_PORT }}
        TARGET: "/home/sshtest/upload/"